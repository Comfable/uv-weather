! function(e, t) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = t() : "function" == typeof define && define.amd ? define(t) : e.autoComplete = t()
}(this, function() {
    "use strict";

    function e(e, t) {
        for (var n = 0; n < t.length; n++) {
            var i = t[n];
            i.enumerable = i.enumerable || !1, i.configurable = !0, "value" in i && (i.writable = !0), Object.defineProperty(e, i.key, i)
        }
    }
    var t = "autoComplete_list",
        n = "autoComplete_result",
        i = "autoComplete_highlighted",
        o = "autoComplete_selected",
        r = 13,
        s = 38,
        a = 40,
        l = function(e) {
            return e.innerHTML = ""
        },
        u = function(e, t, n, i, o, s) {
            i({
                event: e,
                query: t instanceof HTMLInputElement ? t.value : t.innerHTML,
                matches: o.matches,
                results: o.list.map(function(e) {
                    return e.value
                }),
                selection: o.list.find(function(t) {
                    return e.keyCode === r ? t.index === Number(s.getAttribute("data-id")) : "mousedown" === e.type ? t.index === Number(e.currentTarget.getAttribute("data-id")) : void 0
                })
            }), l(n)
        },
        c = {
            getInput: function(e) {
                return "string" == typeof e ? document.querySelector(e) : e()
            },
            createResultsList: function(e) {
                var n = document.createElement(e.element);
                return n.setAttribute("id", t), e.container && e.container(n), e.destination.insertAdjacentElement(e.position, n), n
            },
            highlight: function(e) {
                return "<span class=".concat(i, ">").concat(e, "</span>")
            },
            addResultsToList: function(e, t, i) {
                var o = document.createDocumentFragment();
                t.forEach(function(e, r) {
                    var s = document.createElement(i.element),
                        a = t[r].index;
                    s.setAttribute("data-id", a), s.setAttribute("class", n), i.content ? i.content(e, s) : s.innerHTML = e.match || e, o.appendChild(s)
                }), e.appendChild(o)
            },
            navigation: function(e, t, n, i) {
                var l, c = t.childNodes,
                    d = c.length - 1,
                    h = void 0,
                    v = function(e) {
                        h.classList.remove(o), l = 1 === e ? h.nextSibling : h.previousSibling
                    },
                    f = function(e) {
                        (h = e).classList.add(o)
                    };
                e.onkeydown = function(o) {
                    if (c.length > 0) switch (o.keyCode) {
                        case s:
                            h ? (v(0), f(l || c[d])) : f(c[d]);
                            break;
                        case a:
                            h ? (v(1), f(l || c[0])) : f(c[0]);
                            break;
                        case r:
                            h && u(o, e, t, n, i, h)
                    }
                }, c.forEach(function(o) {
                    o.onmousedown = function(o) {
                        return u(o, e, t, n, i)
                    }
                })
            },
            clearResults: l
        },
        d = function(e, t) {
            t = t || {
                bubbles: !1,
                cancelable: !1,
                detail: void 0
            };
            var n = document.createEvent("CustomEvent");
            return n.initCustomEvent(e, t.bubbles, t.cancelable, t.detail), n
        };
    d.prototype = window.Event.prototype;
    var h = {
        CustomEventWrapper: "function" == typeof window.CustomEvent && window.CustomEvent || d,
        initElementClosestPolyfill: function() {
            Element.prototype.matches || (Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector), Element.prototype.closest || (Element.prototype.closest = function(e) {
                var t = this;
                do {
                    if (t.matches(e)) return t;
                    t = t.parentElement || t.parentNode
                } while (null !== t && 1 === t.nodeType);
                return null
            })
        }
    };
    return function() {
        function t(e) {
            ! function(e, t) {
                if (!(e instanceof t)) throw new TypeError("Cannot call a class as a function")
            }(this, t);
            var n = e.selector,
                i = void 0 === n ? "#autoComplete" : n,
                o = e.data,
                r = o.key,
                s = o.src,
                a = o.cache,
                l = void 0 === a || a,
                u = e.query,
                d = e.trigger,
                h = (d = void 0 === d ? {} : d).event,
                v = void 0 === h ? ["input"] : h,
                f = d.condition,
                m = void 0 !== f && f,
                p = e.searchEngine,
                g = void 0 === p ? "strict" : p,
                y = e.threshold,
                b = void 0 === y ? 0 : y,
                E = e.debounce,
                w = void 0 === E ? 0 : E,
                L = e.resultsList,
                C = (L = void 0 === L ? {} : L).render,
                R = void 0 !== C && C,
                k = L.container,
                x = void 0 !== k && k,
                S = L.destination,
                T = L.position,
                M = void 0 === T ? "afterend" : T,
                q = L.element,
                H = void 0 === q ? "ul" : q,
                A = L.navigation,
                I = void 0 !== A && A,
                P = e.sort,
                j = void 0 !== P && P,
                N = e.placeHolder,
                _ = e.maxResults,
                V = void 0 === _ ? 5 : _,
                W = e.resultItem,
                D = (W = void 0 === W ? {} : W).content,
                F = void 0 !== D && D,
                O = W.element,
                z = void 0 === O ? "li" : O,
                B = e.noResults,
                G = e.highlight,
                J = void 0 !== G && G,
                K = e.onSelection,
                Q = R ? c.createResultsList({
                    container: x,
                    destination: S || c.getInput(i),
                    position: M,
                    element: H
                }) : null;
            this.selector = i, this.data = {
                src: function() {
                    return "function" == typeof s ? s() : s
                },
                key: r,
                cache: l
            }, this.query = u, this.trigger = {
                event: v,
                condition: m
            }, this.searchEngine = "loose" === g ? "loose" : "function" == typeof g ? g : "strict", this.threshold = b, this.debounce = w, this.resultsList = {
                render: R,
                view: Q,
                navigation: I
            }, this.sort = j, this.placeHolder = N, this.maxResults = V, this.resultItem = {
                content: F,
                element: z
            }, this.noResults = B, this.highlight = J, this.onSelection = K, this.init()
        }
        var n, i, o;
        return n = t, (i = [{
            key: "search",
            value: function(e, t) {
                var n = t.toLowerCase();
                var n = n.normalize("NFD").replace(/[\u0300-\u036f]/g, "");
                if (n.includes(e)) return e = new RegExp("".concat(e), "i").exec(t), this.highlight ? t.replace(e, c.highlight(e)) : t
            }
        }, {
            key: "listMatchedResults",
            value: function(e) {
                var t = this;
                return new Promise(function(n) {
                    var i = [];
                    e.filter(function(e, n) {
                        var o = function(o) {
                            var r = o ? e[o] : e;
                            if (r) {
                                var s = "function" == typeof t.searchEngine ? t.searchEngine(t.queryValue, r) : t.search(t.queryValue, r);
                                s && o ? i.push({
                                    key: o,
                                    index: n,
                                    match: s,
                                    value: e
                                }) : s && !o && i.push({
                                    index: n,
                                    match: s,
                                    value: e
                                })
                            }
                        };
                        if (t.data.key) {
                            var r = !0,
                                s = !1,
                                a = void 0;
                            try {
                                for (var l, u = t.data.key[Symbol.iterator](); !(r = (l = u.next()).done); r = !0) {
                                    o(l.value)
                                }
                            } catch (e) {
                                s = !0, a = e
                            } finally {
                                try {
                                    r || null == u.return || u.return()
                                } finally {
                                    if (s) throw a
                                }
                            }
                        } else o()
                    });
                    var o = t.sort ? i.sort(t.sort).slice(0, t.maxResults) : i.slice(0, t.maxResults);
                    return n({
                        matches: i.length,
                        list: o
                    })
                })
            }
        }, {
            key: "ignite",
            value: function() {
                var e = this,
                    t = c.getInput(this.selector);
                this.placeHolder && t.setAttribute("placeholder", this.placeHolder);
                var n = function(n) {
                    Promise.resolve(e.data.cache ? e.dataStream : e.data.src()).then(function(i) {
                        e.dataStream = i,
                            function(n) {
                                var i = t instanceof HTMLInputElement || t instanceof HTMLTextAreaElement ? t.value.toLowerCase() : t.innerHTML.toLowerCase(),
                                    o = e.queryValue = e.query && e.query.manipulate ? e.query.manipulate(i) : i,
                                    r = e.resultsList.render,
                                    s = e.trigger.condition ? e.trigger.condition(o) : o.length > e.threshold && o.replace(/ /g, "").length,
                                    a = function(e, n) {
                                        t.dispatchEvent(new h.CustomEventWrapper("autoComplete", {
                                            bubbles: !0,
                                            detail: {
                                                event: e,
                                                input: i,
                                                query: o,
                                                matches: n ? n.matches : null,
                                                results: n ? n.list : null
                                            },
                                            cancelable: !0
                                        }))
                                    };
                                if (r) {
                                    var l = e.resultsList.view;
                                    c.clearResults(l), s ? e.listMatchedResults(e.dataStream, n).then(function(i) {
                                        a(n, i), e.resultsList.render && (0 === i.list.length && e.noResults ? e.noResults() : (c.addResultsToList(l, i.list, e.resultItem), e.onSelection && (e.resultsList.navigation ? e.resultsList.navigation(n, t, l, e.onSelection, i) : c.navigation(t, l, e.onSelection, i))))
                                    }) : a(n)
                                } else !r && s && e.listMatchedResults(e.dataStream, n).then(function(e) {
                                    a(n, e)
                                })
                            }(n)
                    })
                };
                this.trigger.event.forEach(function(i) {
                    var o, r, s;
                    t.addEventListener(i, (o = function(e) {
                        return n(e)
                    }, r = e.debounce, function() {
                        var e = this,
                            t = arguments;
                        clearTimeout(s), s = setTimeout(function() {
                            return o.apply(e, t)
                        }, r)
                    }))
                })
            }
        }, {
            key: "init",
            value: function() {
                var e = this;
                this.data.cache ? Promise.resolve(this.data.src()).then(function(t) {
                    e.dataStream = t, e.ignite()
                }) : this.ignite(), h.initElementClosestPolyfill()
            }
        }]) && e(n.prototype, i), o && e(n, o), t
    }()
});